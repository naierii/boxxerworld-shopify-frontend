"use strict";(self.webpackChunkboxxerworld_customiser=self.webpackChunkboxxerworld_customiser||[]).push([[354],{7354:(e,i,t)=>{t.r(i),t.d(i,{default:()=>z});var o=t(6015),n=t(4647),a=t(1418),r=t.n(a),l=t(2791),s=t(8148),d=t(1854);const c=async e=>fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});var u=t(4875),v=t(9389),p=t(3418),f=t(7760),h=t(184);const g={intensity:.1},y=(new f.Vector3(0,6,-200),new f.Vector3(-150,0,200),new f.Vector3(100,0,200),()=>{(0,l.useRef)(null);return(0,h.jsxs)("group",{children:[(0,h.jsx)("hemisphereLight",{...g}),(0,h.jsx)("pointLight",{position:[-800,0,-1e3],intensity:.5,decay:12,power:7,castShadow:!0}),(0,h.jsx)("pointLight",{position:[-800,0,1e3],intensity:.5,decay:12,power:7,castShadow:!0}),(0,h.jsx)("pointLight",{position:[800,0,1e3],intensity:.5,decay:120,power:7,castShadow:!0}),(0,h.jsx)("pointLight",{position:[800,0,-1e3],intensity:.5,decay:12,power:7,castShadow:!0})]})}),m=e=>(0,l.forwardRef)(((i,t)=>(0,h.jsx)(l.Suspense,{fallback:(0,h.jsx)(h.Fragment,{}),children:(0,h.jsx)(e,{...i,ref:t})}))),P=(0,l.forwardRef)(((e,i)=>(0,h.jsxs)("mesh",{ref:i,visible:!1,scale:.1,children:[(0,h.jsx)("boxGeometry",{args:[1,1,200]}),(0,h.jsx)("meshNormalMaterial",{})]})));P.displayName="MouseHelper";const w=P,x="CustomiserCanvas_root__1vMOn",b=m((0,l.lazy)((()=>Promise.all([t.e(204),t.e(369)]).then(t.bind(t,9369))))),V=(e,i)=>{var t,o,n,a,r,l,s,d,c,u,v,p,f;return{customProduct:null===(t=e.customProduct)||void 0===t?void 0:t.id,parts:e.savedParts.map((e=>{var i,t;return{name:e.part.name,areaSize:null===(i=e.part.areaSize)||void 0===i||null===(t=i.data)||void 0===t?void 0:t.id,material:e.material.id}})),texts:e.texts.map((e=>{var i,t,o,n,a;return{text:e.text,decalPosition:e.decalPosition,decalOrientation:e.decalOrientation,decalRotation:e.decalRotation,decalScale:e.decalScale,basePriceVariantId:null===(i=e.basePrice)||void 0===i?void 0:i.shopifyVariantId,letterPriceVariantId:null===(t=e.letterPrice)||void 0===t?void 0:t.shopifyVariantId,outlinePriceVariantId:null===(o=e.outlinePrice)||void 0===o?void 0:o.shopifyVariantId,puffPriceVariantId:null===(n=e.puffPrice)||void 0===n?void 0:n.shopifyVariantId,crystalPriceVariantId:null===(a=e.crystalPrice)||void 0===a?void 0:a.shopifyVariantId}})),flags:e.flags.map((e=>{var i,t;return{flag:null===(i=e.flag)||void 0===i?void 0:i.id,decalPosition:e.decalPosition,decalOrientation:e.decalOrientation,decalRotation:e.decalRotation,decalScale:e.decalScale,size:e.size,shopifyVariantId:null===(t=e.basePrice)||void 0===t?void 0:t.shopifyVariantId}})),graphics:e.graphics.map((e=>{var i,t;return{graphic:null===(i=e.graphic)||void 0===i?void 0:i.id,decalPosition:e.decalPosition,decalOrientation:e.decalOrientation,decalRotation:e.decalRotation,decalScale:e.decalScale,size:e.size,shopifyVariantId:null===(t=e.basePrice)||void 0===t?void 0:t.shopifyVariantId}})),images:i,sizing:{shopifyVariantId:null===(o=e.sizing)||void 0===o||null===(n=o.variation)||void 0===n?void 0:n.id,size:null===(a=e.sizing)||void 0===a?void 0:a.size,height:null===(r=e.sizing)||void 0===r||null===(l=r.height)||void 0===l||null===(s=l.value)||void 0===s?void 0:s.toString(),heightUnit:null===(d=e.sizing)||void 0===d||null===(c=d.height)||void 0===c?void 0:c.unit,weight:null===(u=e.sizing)||void 0===u||null===(v=u.weight)||void 0===v?void 0:v.value,weightUnit:null===(p=e.sizing)||void 0===p||null===(f=p.weight)||void 0===f?void 0:f.unit}}},I=e=>{var i,t,o,n,a;const r=null===e||void 0===e?void 0:e.id,l=null===e||void 0===e?void 0:e.attributes;if(!l||!r)return[];const s=[],d=e=>null===e||void 0===e?void 0:e.replace("gid://shopify/ProductVariant/",""),c=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const t=(e=>s.find((i=>i.id===e)))(e);if(t){const e=t.quantity+i;t.quantity=e,t.properties._customDesignQuantity=e}else s.push({id:e,quantity:i,properties:{_customDesignAddon:r,_customDesignQuantity:i}})};return null!==(i=l.parts)&&void 0!==i&&i.length&&l.parts.forEach((e=>{const i=d(null===e||void 0===e?void 0:e.shopifyVariantId);i&&c(i)})),null!==(t=l.flags)&&void 0!==t&&t.length&&l.flags.forEach((e=>{const i=d(null===e||void 0===e?void 0:e.shopifyVariantId);i&&c(i)})),null!==(o=l.graphics)&&void 0!==o&&o.length&&l.graphics.forEach((e=>{const i=d(null===e||void 0===e?void 0:e.shopifyVariantId);i&&c(i)})),null!==(n=l.texts)&&void 0!==n&&n.length&&l.texts.forEach((e=>{var i;const t=d(null===e||void 0===e?void 0:e.basePriceVariantId);t&&c(t);const o=d(null===e||void 0===e?void 0:e.letterPriceVariantId);o&&c(o,null===e||void 0===e||null===(i=e.text)||void 0===i?void 0:i.length);const n=d(null===e||void 0===e?void 0:e.outlinePriceVariantId);n&&c(n);const a=d(null===e||void 0===e?void 0:e.puffPriceVariantId);a&&c(a);const r=d(null===e||void 0===e?void 0:e.crystalPriceVariantId);r&&c(r)})),null!==(a=l.sizing)&&void 0!==a&&a.shopifyVariantId&&s.push({id:d(l.sizing.shopifyVariantId),quantity:1,properties:{_customDesign:r}}),s},S=[0,21970893240496195e-31,15.31024512625285],z=e=>{let{className:i,style:t}=e;const a=(0,l.useRef)(null),g=(0,l.useRef)(null),m=(0,l.useRef)([]),P=(0,l.useRef)(new f.Vector3),z=(0,l.useRef)(new f.Euler),j=(0,l.useRef)(null),k=(0,u.b)((e=>e.flags.find((e=>e.edit)))),R=(0,u.b)((e=>e.texts.find((e=>e.edit)))),C=(0,u.b)((e=>e.graphics.find((e=>e.edit)))),A=(0,u.b)((e=>e.updateGraphic)),O=(0,u.b)((e=>e.updateFlag)),D=(0,u.b)((e=>e.updateText)),_=(0,u.b)((e=>e.setCanvasSize)),F=(0,v.H)((e=>e.resetCamera)),E=(0,v.H)((e=>e.addingToCart)),L=(0,v.H)((e=>e.modelRotation)),M=(0,v.H)((e=>e.setAddingToCart)),H=(0,v.H)((e=>e.setModelRotation)),N=(0,u.b)((e=>e.reset)),T=r()(x,i),q=(0,l.useRef)(null),U=(0,u.b)((e=>e)),[B,G]=(0,l.useState)(!1),[Q,Z]=(0,l.useState)(!1),J=(0,l.useCallback)((e=>{var i;const t=e.point,o=null===e||void 0===e||null===(i=e.face)||void 0===i?void 0:i.normal.clone();q.current&&o&&j.current&&(o.transformDirection(j.current.matrixWorld),o.multiplyScalar(10),o.add(t),q.current.position.copy(t),q.current.lookAt(o))}),[q]),W=(0,l.useCallback)((e=>{G(!1),Z(!1),B&&!Q&&(null!==k&&void 0!==k&&k.key&&(e.stopPropagation(),O(k.key,{decalFreeze:!0}),J(e),q.current&&P.current&&z.current&&(P.current.copy(e.point),z.current.copy(q.current.rotation),O(k.key,{decalPosition:P.current.clone().toArray(),decalOrientation:z.current.clone().toArray()}))),null!==C&&void 0!==C&&C.key&&(e.stopPropagation(),A(C.key,{decalFreeze:!0}),J(e),q.current&&P.current&&z.current&&(P.current.copy(e.point),z.current.copy(q.current.rotation),A(C.key,{decalPosition:P.current.clone().toArray(),decalOrientation:z.current.clone().toArray()}))),null!==R&&void 0!==R&&R.key&&(e.stopPropagation(),D(R.key,{decalFreeze:!0}),J(e),q.current&&P.current&&z.current&&(P.current.copy(e.point),z.current.copy(q.current.rotation),D(R.key,{decalPosition:P.current.clone().toArray(),decalOrientation:z.current.clone().toArray()}))))}),[k,C,R,B,Q]),X=(0,l.useCallback)((()=>{G(!0)}),[]),K=(0,l.useCallback)((e=>{B&&Z(!0)}),[B]),Y=(0,p.D)({mutationFn:c,onSuccess:()=>{window.location.href=window.Shopify.routes.root+"cart",N()}}),{mutate:$}=(0,s.ZF)(d.SL,{onSuccess(e){var i;if(null!==(i=e.createCustomDesign)&&void 0!==i&&i.data){const i=I(e.createCustomDesign.data);Y.mutate({items:i})}}}),{mutateAsync:ee}=(0,s.a1)(d.SL,{onSuccess(e){const i=e.multipleUpload.map((e=>{var i;return null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.id}));$({data:V(U,i)})}});(0,l.useEffect)((()=>{if(E&&L<360)setTimeout((()=>{var e;null===g||void 0===g||null===(e=g.current)||void 0===e||e.toBlob((e=>{if(e){const i=new File([e],"fileName.png",{type:"image/png"});m.current.push(i),H(L+90)}}),"image/png")}),50);else if(E){(async()=>{await ee({files:m.current})})()}}),[L,E,m]),(0,l.useEffect)((()=>{const e=a.current;e&&F&&(e.position.set(S[0],S[1],S[2]),M())}),[F]);const ie=k||C||R;return(0,h.jsx)("div",{className:T,style:t,children:(0,h.jsxs)(n.Xz,{linear:!0,flat:!0,camera:{position:S,fov:45},dpr:window.devicePixelRatio,gl:{preserveDrawingBuffer:!0},ref:g,onCreated:e=>{_(e.size.width,e.size.height),a.current=e.camera},frameloop:"demand",children:[(0,h.jsx)(b,{onClick:W,onPointerDown:X,onPointerMove:K,ref:j}),(0,h.jsx)(y,{}),ie&&(0,h.jsx)(w,{ref:q}),(0,h.jsx)(o.z,{enableZoom:!0,minPolarAngle:Math.PI/3,maxPolarAngle:Math.PI/1.9})]})})}}}]);
//# sourceMappingURL=354.83fa8de2.chunk.js.map